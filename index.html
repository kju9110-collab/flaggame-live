<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>êµ­ê¸° ì„œë°”ì´ë²Œ - ë§ˆì§€ë§‰ í•˜ë‚˜ê¹Œì§€!</title>
    <style>
        body { margin: 0; background-color: #90D5FF; overflow: hidden; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        .info-panel { margin-top: 15px; display: flex; gap: 15px; z-index: 10; }
        .ui-box { background: white; border: 2px solid black; border-radius: 12px; padding: 8px 20px; text-align: center; min-width: 100px; box-shadow: 2px 2px 0px rgba(0,0,0,0.2); }
        #arena-container { position: relative; margin: 50px 0; } /* ê°„ê²©ì„ ì¶©ë¶„íˆ ë„ì›€ */
        #arena { width: 320px; height: 320px; border: 8px solid black; border-radius: 50%; background-color: white; position: relative; overflow: visible; }
        #hole { position: absolute; right: -12px; top: 50%; transform: translateY(-50%); width: 20px; height: 60px; background-color: #90D5FF; z-index: 5; }
        .flag { position: absolute; width: 30px; height: 20px; background-size: cover; border: 0.5px solid #ccc; z-index: 2; }
        #flag-list { width: 95%; display: grid; grid-template-columns: repeat(10, 1fr); gap: 3px; padding: 10px; background: rgba(255,255,255,0.4); border-radius: 10px; }
        .list-flag { width: 100%; height: 20px; background-size: cover; border: 0.5px solid #555; }
    </style>
</head>
<body>

<div class="info-panel">
    <div class="ui-box"><b>LAST WINNER</b><br><span id="winner-name">-</span></div>
    <div class="ui-box"><b>SURVIVORS</b><br><span id="survivor-count">0</span></div>
</div>

<div id="arena-container">
    <div id="arena"><div id="hole"></div></div>
</div>

<div id="flag-list"></div>

<script>
    const arena = document.getElementById('arena');
    const flagListContainer = document.getElementById('flag-list');
    const winnerDisplay = document.getElementById('winner-name');
    const survivorDisplay = document.getElementById('survivor-count');
    
    const radius = 160;
    let flags = [];
    
    // 60ê°œ ì´ìƒì˜ ë‹¤ì–‘í•œ êµ­ê°€ ì½”ë“œ (ì¤‘ë³µ ì—†ì´ ì„ íƒë¨)
    const allCountries = ['kr','us','jp','cn','fr','de','gb','it','br','ca','mx','vn','au','in','es','ru','nl','se','no','ch','at','be','dk','fi','gr','ie','pt','tr','pl','cz','hu','ro','th','id','my','ph','sg','nz','za','eg','ar','cl','co','pe','sa','ae','qa','kw','is','vn','ua','il','mx','ng','gh','ke','ma','dz','eg'];

    function initGame() {
        arena.querySelectorAll('.flag').forEach(el => el.remove());
        flagListContainer.innerHTML = '';
        flags = [];

        // 1. ì‚¬ìš©í•  êµ­ê°€ 20ê°œë¥¼ ì¤‘ë³µ ì—†ì´ ë¬´ì‘ìœ„ ì„ íƒ
        const selectedCountries = [...allCountries].sort(() => Math.random() - 0.5).slice(0, 20);

        // 2. ê³µ ìƒì„± (í•œ ê²Œì„ì— í•œ ë‚˜ë¼ì”©)
        selectedCountries.forEach((code) => {
            const el = document.createElement('div');
            el.className = 'flag';
            el.style.backgroundImage = `url('https://flagcdn.com/w40/${code}.png')`;
            arena.appendChild(el);

            const angle = Math.random() * Math.PI * 2;
            const speed = 3 + Math.random() * 2; // ì†ë„ë¥¼ ì•½ê°„ ë†’ì—¬ ë©ˆì¶¤ ë°©ì§€
            flags.push({ el, code, x: radius, y: radius, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, out: false });

            // í•˜ë‹¨ ëª©ë¡ì—ë„ ì¶”ê°€
            const f = document.createElement('div');
            f.className = 'list-flag';
            f.style.backgroundImage = `url('https://flagcdn.com/w40/${code}.png')`;
            flagListContainer.appendChild(f);
        });
        
        survivorDisplay.innerText = flags.length;
        update();
    }

    function update() {
        let activeFlags = flags.filter(f => !f.out);
        survivorDisplay.innerText = activeFlags.length;

        activeFlags.forEach(f => {
            f.x += f.vx;
            f.y += f.vy;

            const dx = f.x - radius, dy = f.y - radius;
            const dist = Math.sqrt(dx * dx + dy * dy);

            // ğŸ”´ êµ¬ë©ìœ¼ë¡œ ë‚˜ê°€ëŠ” ë¡œì§ (ì„œë°”ì´ë²Œ: ë‚˜ê°€ëŠ” ìˆœì„œëŒ€ë¡œ íƒˆë½)
            if (f.x > radius + 145 && f.y > radius - 30 && f.y < radius + 30) {
                f.out = true;
                f.el.style.display = 'none';
                
                // ë§ˆì§€ë§‰ í•˜ë‚˜ ë‚¨ì•˜ëŠ”ì§€ ì²´í¬
                checkGameOver();
                return;
            }

            // ë²½ ì¶©ëŒ (ê°ë„ ë¬´ì‘ìœ„ì„± ê°•í™”ë¡œ ë©ˆì¶¤/ë¼ì„ ë°©ì§€)
            if (dist + 15 > radius) {
                const nx = dx / dist, ny = dy / dist;
                const dot = f.vx * nx + f.vy * ny;
                f.vx -= 2 * dot * nx;
                f.vy -= 2 * dot * ny;
                
                const shift = (Math.random() - 0.5) * 0.4;
                const cos = Math.cos(shift), sin = Math.sin(shift);
                const oldVx = f.vx;
                f.vx = f.vx * cos - f.vy * sin;
                f.vy = oldVx * sin + f.vy * cos;

                f.x = radius + nx * (radius - 15.2);
                f.y = radius + ny * (radius - 15.2);
            }

            f.el.style.left = (f.x - 15) + 'px';
            f.el.style.top = (f.y - 10) + 'px';
        });

        if (flags.filter(f => !f.out).length > 1) {
            requestAnimationFrame(update);
        }
    }

    function checkGameOver() {
        const remaining = flags.filter(f => !f.out);
        if (remaining.length === 1) {
            // ë§ˆì§€ë§‰ ë‚¨ì€ êµ­ê¸°ê°€ ìš°ìŠ¹!
            const winner = remaining[0];
            winnerDisplay.innerText = winner.code.toUpperCase();
            winner.el.style.transform = "scale(2)"; // ìš°ìŠ¹ì ê°•ì¡°
            winner.el.style.zIndex = "100";
            
            // 3ì´ˆ í›„ ìë™ ë¦¬ì…‹ (ë¬´í•œ ë°˜ë³µ)
            setTimeout(initGame, 3000);
        }
    }

    initGame();
</script>
</body>
</html>
