<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì„¸ê³„ 50ëŒ€êµ­ ì„œë°”ì´ë²Œ - ì—­ìˆœ ìŒ“ê¸°</title>
    <style>
        body { margin: 0; background-color: #90D5FF; overflow: hidden; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        .info-panel { margin-top: 15px; display: flex; gap: 15px; z-index: 10; }
        .ui-box { background: white; border: 2px solid black; border-radius: 12px; padding: 8px 20px; text-align: center; min-width: 100px; box-shadow: 2px 2px 0px rgba(0,0,0,0.2); }
        
        #arena-container { position: relative; margin: 40px 0; }
        #arena { width: 320px; height: 320px; border: 8px solid black; border-radius: 50%; background-color: white; position: relative; overflow: visible; }
        #hole { position: absolute; right: -12px; top: 50%; transform: translateY(-50%); width: 20px; height: 60px; background-color: #90D5FF; z-index: 5; }
        
        .flag { position: absolute; width: 30px; height: 20px; background-size: cover; border: 0.5px solid #ccc; z-index: 2; border-radius: 2px; }

        /* í•˜ë‹¨ ì˜ì—­: 50ê°œì˜ ì¹¸ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘  */
        #flag-list { 
            width: 95%; display: grid; grid-template-columns: repeat(10, 1fr); 
            grid-template-rows: repeat(5, 1fr); gap: 4px; padding: 10px; 
            background: rgba(255,255,255,0.4); border-radius: 10px; border: 2px solid rgba(0,0,0,0.1);
            min-height: 130px;
        }
        /* ë¹ˆ ì¹¸ ìŠ¤íƒ€ì¼ */
        .slot { width: 100%; height: 22px; border: 0.5px dashed rgba(0,0,0,0.1); border-radius: 2px; }
        /* ì±„ì›Œì§„ êµ­ê¸° ìŠ¤íƒ€ì¼ */
        .list-flag { width: 100%; height: 100%; background-size: cover; border: 0.5px solid #555; border-radius: 2px; animation: popIn 0.3s ease-out; }
        
        @keyframes popIn { from { transform: scale(1.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

<div class="info-panel">
    <div class="ui-box"><b>ìš°ìŠ¹(1ë“±)</b><br><span id="winner-name">-</span></div>
    <div class="ui-box"><b>ê²½ê¸° ì¤‘</b><br><span id="survivor-count">0</span></div>
</div>

<div id="arena-container">
    <div id="arena"><div id="hole"></div></div>
</div>

<div id="flag-list"></div>

<script>
    const arena = document.getElementById('arena');
    const flagListContainer = document.getElementById('flag-list');
    const winnerDisplay = document.getElementById('winner-name');
    const survivorDisplay = document.getElementById('survivor-count');
    
    const radius = 160;
    let flags = [];
    let exitOrder = []; // ë‚˜ê°€ëŠ” ìˆœì„œë¥¼ ì €ì¥
    
    const econ50 = ['us','cn','jp','de','in','gb','fr','it','ca','br','ru','kr','au','es','mx','id','nl','sa','tr','ch','tw','pl','se','be','eg','ie','th','no','ar','il','ae','za','dk','my','sg','ph','vn','ro','cz','cl','fi','co','at','hk','pk','hu','pe','gr','nz','dz'];

    function initGame() {
        arena.querySelectorAll('.flag').forEach(el => el.remove());
        flagListContainer.innerHTML = '';
        flags = [];
        exitOrder = [];
        winnerDisplay.innerText = "-";

        // 50ê°œ ì¹¸(Slot)ì„ ë¯¸ë¦¬ ìƒì„±
        for(let i=0; i<50; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.id = 'slot-' + i;
            flagListContainer.appendChild(slot);
        }

        // ê²½ì œ 50ëŒ€êµ­ ëª¨ë‘ ì°¸ì—¬
        const selected = [...econ50].sort(() => Math.random() - 0.5);

        selected.forEach((code) => {
            const el = document.createElement('div');
            el.className = 'flag';
            el.style.backgroundImage = `url('https://flagcdn.com/w40/${code}.png')`;
            arena.appendChild(el);

            const angle = Math.random() * Math.PI * 2;
            const speed = 2.5 + Math.random() * 2;
            flags.push({ el, code, x: radius, y: radius, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, out: false });
        });
        
        survivorDisplay.innerText = flags.length;
        requestAnimationFrame(update);
    }

    function update() {
        let activeFlags = flags.filter(f => !f.out);
        survivorDisplay.innerText = activeFlags.length;

        activeFlags.forEach(f => {
            f.x += f.vx; f.y += f.vy;
            const dx = f.x - radius, dy = f.y - radius;
            const dist = Math.sqrt(dx * dx + dy * dy);

            // ğŸ”´ êµ¬ë©ìœ¼ë¡œ íƒˆë½ ì‹œ ë¡œì§
            if (f.x > radius + 145 && f.y > radius - 30 && f.y < radius + 30) {
                f.out = true;
                f.el.style.display = 'none';
                
                // íƒˆë½ ìˆœì„œëŒ€ë¡œ ë’¤ì—ì„œë¶€í„° ì±„ìš°ê¸°
                // 50ê°œ ì¤‘ ë¨¼ì € ë‚˜ê°„ ê³µì€ 49ë²ˆ ì¹¸, ê·¸ ë‹¤ìŒì€ 48ë²ˆ ì¹¸...
                const slotIndex = 49 - exitOrder.length;
                const targetSlot = document.getElementById('slot-' + slotIndex);
                if(targetSlot) {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-flag';
                    listItem.style.backgroundImage = f.el.style.backgroundImage;
                    targetSlot.appendChild(listItem);
                }
                
                exitOrder.push(f.code);
                checkGameOver();
                return;
            }

            if (dist + 15 > radius) {
                const nx = dx / dist, ny = dy / dist;
                const dot = f.vx * nx + f.vy * ny;
                f.vx -= 2 * dot * nx; f.vy -= 2 * dot * ny;
                
                const shift = (Math.random() - 0.5) * 0.4;
                const cos = Math.cos(shift), sin = Math.sin(shift);
                const oldVx = f.vx;
                f.vx = f.vx * cos - f.vy * sin;
                f.vy = oldVx * sin + f.vy * cos;

                f.x = radius + nx * (radius - 15.2);
                f.y = radius + ny * (radius - 15.2);
            }
            f.el.style.left = (f.x - 15) + 'px';
            f.el.style.top = (f.y - 10) + 'px';
        });

        if (flags.filter(f => !f.out).length > 1) {
            requestAnimationFrame(update);
        }
    }

    function checkGameOver() {
        const remaining = flags.filter(f => !f.out);
        if (remaining.length === 1) {
            const winner = remaining[0];
            winnerDisplay.innerText = winner.code.toUpperCase();
            winner.el.style.transform = "scale(3)";
            winner.el.style.transition = "all 0.5s";
            winner.el.style.left = "145px";
            winner.el.style.top = "150px";
            
            // ìš°ìŠ¹ìëŠ” 0ë²ˆ ì¹¸(ë§¨ ì™¼ìª½ ìœ„)ì— ë°°ì¹˜
            setTimeout(() => {
                const targetSlot = document.getElementById('slot-0');
                if(targetSlot) {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-flag';
                    listItem.style.backgroundImage = winner.el.style.backgroundImage;
                    listItem.style.border = "2px solid gold";
                    targetSlot.appendChild(listItem);
                }
            }, 1000);

            setTimeout(initGame, 5000); // 5ì´ˆ í›„ ë¦¬ì…‹
        }
    }

    initGame();
</script>
</body>
</html>
