<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body style="margin:0; padding:0; overflow:hidden;">
    <script>
    let flags = [];
    let exitedFlags = [];
    let holeSize = 36; 
    let winner = null;
    let winTimer = 0;

    function setup() {
      createCanvas(windowWidth, 800);
      textAlign(CENTER, CENTER);
      initGame();
    }

    function initGame() {
      flags = [];
      exitedFlags = [];
      winner = null;
      winTimer = 0;
      for (let i = 1; i <= 20; i++) {
        flags.push(new Flag(i));
      }
    }

    function draw() {
      background(240);
      translate(width / 2, 250);
      noFill();
      stroke(0);
      strokeWeight(4);
      arc(0, 0, 300, 300, radians(holeSize/2), radians(360 - holeSize/2));
      
      for (let i = flags.length - 1; i >= 0; i--) {
        flags[i].update();
        flags[i].display();
        let ang = degrees(atan2(flags[i].y, flags[i].x)) + 90;
        if (ang < 0) ang += 360;
        if (dist(0, 0, flags[i].x, flags[i].y) > 140 && (ang < holeSize/2 || ang > 360 - holeSize/2)) {
          let f = flags.splice(i, 1)[0];
          exitedFlags.push(f);
          if (flags.length === 0) {
            winner = f;
            winTimer = millis();
          }
        }
      }

      resetMatrix();
      for (let i = 0; i < exitedFlags.length; i++) {
        let row = floor(i / 10);
        let col = i % 10;
        fill(100, 200, 100);
        rect(width/2 - 225 + col * 45, 500 + row * 45, 40, 40);
        fill(255);
        textSize(12);
        text(exitedFlags[i].id, width/2 - 205 + col * 45, 520 + row * 45);
      }

      if (winner && millis() - winTimer < 2000) {
        fill(255, 0, 0);
        textSize(50);
        text("1등: 국기 " + winner.id, width / 2, height / 2);
      } else if (winner && millis() - winTimer >= 2000) {
        initGame();
      }
    }

    class Flag {
      constructor(id) {
        this.id = id;
        this.x = random(-50, 50);
        this.y = random(-50, 50);
        this.vx = random(-4, 4);
        this.vy = random(-4, 4);
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (dist(0, 0, this.x, this.y) > 140) {
          let angle = atan2(this.y, this.x);
          this.vx *= -1; 
          this.vy *= -1;
          this.x = cos(angle) * 140;
          this.y = sin(angle) * 140;
        }
      }
      display() {
        fill(255);
        stroke(0);
        strokeWeight(1);
        ellipse(this.x, this.y, 25, 25);
        fill(0);
        noStroke();
        textSize(12);
        text(this.id, this.x, this.y);
      }
    }
    </script>
</body>
</html>
